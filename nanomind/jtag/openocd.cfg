# General OpenOCD configuration file

source [find interface/olimex-arm-usb-tiny-h.cfg]
source [find nanomind3.cfg]
source [find at91sam7a1.cfg]

arm7_9 fast_memory_access enable
arm7_9 dcc_downloads enable

init
halt
#reset init

# Setup chip selects
$_TARGETNAME mww 0xFFE00000 0x400030A5
$_TARGETNAME mww 0xFFE00004 0x480030A5
$_TARGETNAME mww 0xFFE00008 0x500030A5

# Remap
$_TARGETNAME mww 0xFFE00020 0x00000001

# Clear status and set in read mode
echo "Clear flash status"
$_TARGETNAME mwb 0x40000000 0x50
$_TARGETNAME mwb 0x40000000 0x70
$_TARGETNAME mwb 0x40000000 0xFF

# Unlock every sector of flash
echo "Unlocking flash"
$_TARGETNAME mwb 0x40000000 0x60
$_TARGETNAME mwb 0x40000000 0xD0
$_TARGETNAME mwb 0x40000000 0xFF

$_TARGETNAME mwb 0x40002000 0x60
$_TARGETNAME mwb 0x40002000 0xD0
$_TARGETNAME mwb 0x40002000 0xFF

$_TARGETNAME mwb 0x40004000 0x60
$_TARGETNAME mwb 0x40004000 0xD0
$_TARGETNAME mwb 0x40004000 0xFF

$_TARGETNAME mwb 0x40006000 0x60
$_TARGETNAME mwb 0x40006000 0xD0
$_TARGETNAME mwb 0x40006000 0xFF

$_TARGETNAME mwb 0x40008000 0x60
$_TARGETNAME mwb 0x40008000 0xD0
$_TARGETNAME mwb 0x40008000 0xFF

$_TARGETNAME mwb 0x4000a000 0x60
$_TARGETNAME mwb 0x4000a000 0xD0
$_TARGETNAME mwb 0x4000a000 0xFF

$_TARGETNAME mwb 0x4000c000 0x60
$_TARGETNAME mwb 0x4000c000 0xD0
$_TARGETNAME mwb 0x4000c000 0xFF

$_TARGETNAME mwb 0x4000e000 0x60
$_TARGETNAME mwb 0x4000e000 0xD0
$_TARGETNAME mwb 0x4000e000 0xFF

$_TARGETNAME mwb 0x40010000 0x60
$_TARGETNAME mwb 0x40010000 0xD0
$_TARGETNAME mwb 0x40010000 0xFF

$_TARGETNAME mwb 0x40020000 0x60
$_TARGETNAME mwb 0x40020000 0xD0
$_TARGETNAME mwb 0x40020000 0xFF

$_TARGETNAME mwb 0x40030000 0x60
$_TARGETNAME mwb 0x40030000 0xD0
$_TARGETNAME mwb 0x40030000 0xFF

$_TARGETNAME mwb 0x40040000 0x60
$_TARGETNAME mwb 0x40040000 0xD0
$_TARGETNAME mwb 0x40040000 0xFF

$_TARGETNAME mwb 0x40050000 0x60
$_TARGETNAME mwb 0x40050000 0xD0
$_TARGETNAME mwb 0x40050000 0xFF

$_TARGETNAME mwb 0x40060000 0x60
$_TARGETNAME mwb 0x40060000 0xD0
$_TARGETNAME mwb 0x40060000 0xFF

$_TARGETNAME mwb 0x40070000 0x60
$_TARGETNAME mwb 0x40070000 0xD0
$_TARGETNAME mwb 0x40070000 0xFF

$_TARGETNAME mwb 0x40080000 0x60
$_TARGETNAME mwb 0x40080000 0xD0
$_TARGETNAME mwb 0x40080000 0xFF

$_TARGETNAME mwb 0x40090000 0x60
$_TARGETNAME mwb 0x40090000 0xD0
$_TARGETNAME mwb 0x40090000 0xFF

$_TARGETNAME mwb 0x400a0000 0x60
$_TARGETNAME mwb 0x400a0000 0xD0
$_TARGETNAME mwb 0x400a0000 0xFF

$_TARGETNAME mwb 0x400b0000 0x60
$_TARGETNAME mwb 0x400b0000 0xD0
$_TARGETNAME mwb 0x400b0000 0xFF

$_TARGETNAME mwb 0x400c0000 0x60
$_TARGETNAME mwb 0x400c0000 0xD0
$_TARGETNAME mwb 0x400c0000 0xFF

$_TARGETNAME mwb 0x400d0000 0x60
$_TARGETNAME mwb 0x400d0000 0xD0
$_TARGETNAME mwb 0x400d0000 0xFF

$_TARGETNAME mwb 0x400e0000 0x60
$_TARGETNAME mwb 0x400e0000 0xD0
$_TARGETNAME mwb 0x400e0000 0xFF

$_TARGETNAME mwb 0x400f0000 0x60
$_TARGETNAME mwb 0x400f0000 0xD0
$_TARGETNAME mwb 0x400f0000 0xFF

$_TARGETNAME mwb 0x40100000 0x60
$_TARGETNAME mwb 0x40100000 0xD0
$_TARGETNAME mwb 0x40100000 0xFF

$_TARGETNAME mwb 0x40110000 0x60
$_TARGETNAME mwb 0x40110000 0xD0
$_TARGETNAME mwb 0x40110000 0xFF

$_TARGETNAME mwb 0x40120000 0x60
$_TARGETNAME mwb 0x40120000 0xD0
$_TARGETNAME mwb 0x40120000 0xFF

$_TARGETNAME mwb 0x40130000 0x60
$_TARGETNAME mwb 0x40130000 0xD0
$_TARGETNAME mwb 0x40130000 0xFF

$_TARGETNAME mwb 0x40140000 0x60
$_TARGETNAME mwb 0x40140000 0xD0
$_TARGETNAME mwb 0x40140000 0xFF

$_TARGETNAME mwb 0x40150000 0x60
$_TARGETNAME mwb 0x40150000 0xD0
$_TARGETNAME mwb 0x40150000 0xFF

$_TARGETNAME mwb 0x40160000 0x60
$_TARGETNAME mwb 0x40160000 0xD0
$_TARGETNAME mwb 0x40160000 0xFF

$_TARGETNAME mwb 0x40170000 0x60
$_TARGETNAME mwb 0x40170000 0xD0
$_TARGETNAME mwb 0x40170000 0xFF

$_TARGETNAME mwb 0x40180000 0x60
$_TARGETNAME mwb 0x40180000 0xD0
$_TARGETNAME mwb 0x40180000 0xFF

$_TARGETNAME mwb 0x40190000 0x60
$_TARGETNAME mwb 0x40190000 0xD0
$_TARGETNAME mwb 0x40190000 0xFF

$_TARGETNAME mwb 0x401a0000 0x60
$_TARGETNAME mwb 0x401a0000 0xD0
$_TARGETNAME mwb 0x401a0000 0xFF

$_TARGETNAME mwb 0x401b0000 0x60
$_TARGETNAME mwb 0x401b0000 0xD0
$_TARGETNAME mwb 0x401b0000 0xFF

$_TARGETNAME mwb 0x401c0000 0x60
$_TARGETNAME mwb 0x401c0000 0xD0
$_TARGETNAME mwb 0x401c0000 0xFF

$_TARGETNAME mwb 0x401d0000 0x60
$_TARGETNAME mwb 0x401d0000 0xD0
$_TARGETNAME mwb 0x401d0000 0xFF

$_TARGETNAME mwb 0x401e0000 0x60
$_TARGETNAME mwb 0x401e0000 0xD0
$_TARGETNAME mwb 0x401e0000 0xFF

$_TARGETNAME mwb 0x401f0000 0x60
$_TARGETNAME mwb 0x401f0000 0xD0
$_TARGETNAME mwb 0x401f0000 0xFF

$_TARGETNAME mwb 0x40200000 0x60
$_TARGETNAME mwb 0x40200000 0xD0
$_TARGETNAME mwb 0x40200000 0xFF

$_TARGETNAME mwb 0x40210000 0x60
$_TARGETNAME mwb 0x40210000 0xD0
$_TARGETNAME mwb 0x40210000 0xFF

$_TARGETNAME mwb 0x40220000 0x60
$_TARGETNAME mwb 0x40220000 0xD0
$_TARGETNAME mwb 0x40220000 0xFF

$_TARGETNAME mwb 0x40230000 0x60
$_TARGETNAME mwb 0x40230000 0xD0
$_TARGETNAME mwb 0x40230000 0xFF

$_TARGETNAME mwb 0x40240000 0x60
$_TARGETNAME mwb 0x40240000 0xD0
$_TARGETNAME mwb 0x40240000 0xFF

$_TARGETNAME mwb 0x40250000 0x60
$_TARGETNAME mwb 0x40250000 0xD0
$_TARGETNAME mwb 0x40250000 0xFF

$_TARGETNAME mwb 0x40260000 0x60
$_TARGETNAME mwb 0x40260000 0xD0
$_TARGETNAME mwb 0x40260000 0xFF

$_TARGETNAME mwb 0x40270000 0x60
$_TARGETNAME mwb 0x40270000 0xD0
$_TARGETNAME mwb 0x40270000 0xFF

$_TARGETNAME mwb 0x40280000 0x60
$_TARGETNAME mwb 0x40280000 0xD0
$_TARGETNAME mwb 0x40280000 0xFF

$_TARGETNAME mwb 0x40290000 0x60
$_TARGETNAME mwb 0x40290000 0xD0
$_TARGETNAME mwb 0x40290000 0xFF

$_TARGETNAME mwb 0x402a0000 0x60
$_TARGETNAME mwb 0x402a0000 0xD0
$_TARGETNAME mwb 0x402a0000 0xFF

$_TARGETNAME mwb 0x402b0000 0x60
$_TARGETNAME mwb 0x402b0000 0xD0
$_TARGETNAME mwb 0x402b0000 0xFF

$_TARGETNAME mwb 0x402c0000 0x60
$_TARGETNAME mwb 0x402c0000 0xD0
$_TARGETNAME mwb 0x402c0000 0xFF

$_TARGETNAME mwb 0x402d0000 0x60
$_TARGETNAME mwb 0x402d0000 0xD0
$_TARGETNAME mwb 0x402d0000 0xFF

$_TARGETNAME mwb 0x402e0000 0x60
$_TARGETNAME mwb 0x402e0000 0xD0
$_TARGETNAME mwb 0x402e0000 0xFF

$_TARGETNAME mwb 0x402f0000 0x60
$_TARGETNAME mwb 0x402f0000 0xD0
$_TARGETNAME mwb 0x402f0000 0xFF

$_TARGETNAME mwb 0x40300000 0x60
$_TARGETNAME mwb 0x40300000 0xD0
$_TARGETNAME mwb 0x40300000 0xFF

$_TARGETNAME mwb 0x40310000 0x60
$_TARGETNAME mwb 0x40310000 0xD0
$_TARGETNAME mwb 0x40310000 0xFF

$_TARGETNAME mwb 0x40320000 0x60
$_TARGETNAME mwb 0x40320000 0xD0
$_TARGETNAME mwb 0x40320000 0xFF

$_TARGETNAME mwb 0x40330000 0x60
$_TARGETNAME mwb 0x40330000 0xD0
$_TARGETNAME mwb 0x40330000 0xFF

$_TARGETNAME mwb 0x40340000 0x60
$_TARGETNAME mwb 0x40340000 0xD0
$_TARGETNAME mwb 0x40340000 0xFF

$_TARGETNAME mwb 0x40350000 0x60
$_TARGETNAME mwb 0x40350000 0xD0
$_TARGETNAME mwb 0x40350000 0xFF

$_TARGETNAME mwb 0x40360000 0x60
$_TARGETNAME mwb 0x40360000 0xD0
$_TARGETNAME mwb 0x40360000 0xFF

$_TARGETNAME mwb 0x40370000 0x60
$_TARGETNAME mwb 0x40370000 0xD0
$_TARGETNAME mwb 0x40370000 0xFF

$_TARGETNAME mwb 0x40380000 0x60
$_TARGETNAME mwb 0x40380000 0xD0
$_TARGETNAME mwb 0x40380000 0xFF

$_TARGETNAME mwb 0x40390000 0x60
$_TARGETNAME mwb 0x40390000 0xD0
$_TARGETNAME mwb 0x40390000 0xFF

$_TARGETNAME mwb 0x403a0000 0x60
$_TARGETNAME mwb 0x403a0000 0xD0
$_TARGETNAME mwb 0x403a0000 0xFF

$_TARGETNAME mwb 0x403b0000 0x60
$_TARGETNAME mwb 0x403b0000 0xD0
$_TARGETNAME mwb 0x403b0000 0xFF

$_TARGETNAME mwb 0x403c0000 0x60
$_TARGETNAME mwb 0x403c0000 0xD0
$_TARGETNAME mwb 0x403c0000 0xFF

$_TARGETNAME mwb 0x403d0000 0x60
$_TARGETNAME mwb 0x403d0000 0xD0
$_TARGETNAME mwb 0x403d0000 0xFF

$_TARGETNAME mwb 0x403e0000 0x60
$_TARGETNAME mwb 0x403e0000 0xD0
$_TARGETNAME mwb 0x403e0000 0xFF

$_TARGETNAME mwb 0x403f0000 0x60
$_TARGETNAME mwb 0x403f0000 0xD0
$_TARGETNAME mwb 0x403f0000 0xFF

$_TARGETNAME mwb 0x403f2000 0x60
$_TARGETNAME mwb 0x403f2000 0xD0
$_TARGETNAME mwb 0x403f2000 0xFF

$_TARGETNAME mwb 0x403f4000 0x60
$_TARGETNAME mwb 0x403f4000 0xD0
$_TARGETNAME mwb 0x403f4000 0xFF

$_TARGETNAME mwb 0x403f6000 0x60
$_TARGETNAME mwb 0x403f6000 0xD0
$_TARGETNAME mwb 0x403f6000 0xFF

$_TARGETNAME mwb 0x403f8000 0x60
$_TARGETNAME mwb 0x403f8000 0xD0
$_TARGETNAME mwb 0x403f8000 0xFF

$_TARGETNAME mwb 0x403fa000 0x60
$_TARGETNAME mwb 0x403fa000 0xD0
$_TARGETNAME mwb 0x403fa000 0xFF

$_TARGETNAME mwb 0x403fc000 0x60
$_TARGETNAME mwb 0x403fc000 0xD0
$_TARGETNAME mwb 0x403fc000 0xFF

$_TARGETNAME mwb 0x403fe000 0x60
$_TARGETNAME mwb 0x403fe000 0xD0
$_TARGETNAME mwb 0x403fe000 0xFF

# Disable watchdog timer
echo "Disabling watchdog timer"
mww 0xfffa0068 0x00002340

# Uncomment these to program the OBC
flash erase_sector 0 0 25
flash write_bank 0 ../build/nanomind.bin 0
reset
shutdown
